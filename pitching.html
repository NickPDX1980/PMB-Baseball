<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pitching Stats - Parkrose MS Baseball</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <h1>Pitching Statistics</h1>

    <div class="table-container">
        <table>
            <thead id="pitching-thead">
                </thead>
            <tbody id="pitching-tbody">
                <tr><td>Loading stats...</td></tr> </tbody>
        </table>
    </div>
    <div id="error-container"></div> <a href="index.html" class="nav-link">&laquo; Back to Home</a>

    <script>
        // --- Paste the SAME updated loadCsvData function from batting.html here ---
        async function loadCsvData(csvFilename, theadId, tbodyId, errorContainerId) {
            const thead = document.getElementById(theadId);
            const tbody = document.getElementById(tbodyId);
            const errorContainer = document.getElementById(errorContainerId);

            // Clear previous content/errors
            thead.innerHTML = '';
            tbody.innerHTML = '<tr><td>Loading stats...</td></tr>'; // Placeholder
            errorContainer.innerHTML = '';

            try {
                console.log(`Workspaceing: ${csvFilename}`);
                const response = await fetch(csvFilename);
                console.log(`Workspace response status for ${csvFilename}: ${response.status}`);

                if (!response.ok) {
                    throw new Error(`Network response was not ok: ${response.statusText} (Status: ${response.status}). Check file path and permissions.`);
                }

                const csvData = await response.text();
                console.log(`--- Raw CSV Data for ${csvFilename} ---`);
                // console.log(csvData); // Keep commented unless debugging raw data
                console.log(`--- End Raw CSV Data ---`);

                const lines = csvData.trim().split(/\r?\n/); // Robust line splitting
                console.log(`Number of lines found after split for ${csvFilename}: ${lines.length}`);

                if (lines.length < 1 || lines[0].trim() === '') {
                    tbody.innerHTML = '<tr><td>CSV file appears to be empty or missing headers.</td></tr>';
                    console.error(`CSV file '${csvFilename}' is empty or header row is missing.`);
                    return;
                }

                // --- Process Header Row (lines[0]) ---
                const headerValues = lines[0].split(',');
                const numColumns = headerValues.length;
                const headerRow = document.createElement('tr');

                headerValues.forEach((headerText, index) => {
                    const th = document.createElement('th');
                    th.textContent = headerText.trim();
                    th.dataset.columnIndex = index; // Store index for sorting
                    th.title = `Click to sort by ${headerText.trim()}`; // Tooltip

                    // Add click listener placeholder for sorting (we'll implement sortTable soon)
                    th.addEventListener('click', (event) => {
                         const clickedHeader = event.currentTarget;
                         console.log(`Clicked header: ${headerText.trim()}, Column index: ${index}`);
                         // sortTable(index, tbodyId, clickedHeader); // Call sorting function here eventually
                         alert(`Sorting by column ${index + 1} ("${headerText.trim()}") - functionality coming soon!`);
                    });
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
                console.log(`Processed header with ${numColumns} columns for ${csvFilename}.`);


                // --- Process Data Rows (lines[1] onwards) ---
                tbody.innerHTML = ''; // Clear "Loading..." message before adding data

                if (lines.length <= 1) {
                     tbody.innerHTML = `<tr><td colspan="${numColumns}">No data rows found below the header.</td></tr>`;
                     console.warn(`CSV file '${csvFilename}' contains only a header row.`);
                     return;
                }

                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim() === '') {
                        continue; // Skip empty lines
                    }
                    const dataValues = lines[i].split(',');
                    const dataRow = document.createElement('tr');

                    // Iterate based on the number of columns found in the header
                    for (let j = 0; j < numColumns; j++) {
                        const td = document.createElement('td');
                        // Use value or empty string if data is missing for a column in this row
                        td.textContent = dataValues[j] ? dataValues[j].trim() : '';
                        dataRow.appendChild(td);
                    }
                    tbody.appendChild(dataRow);
                }
                console.log(`Successfully processed ${lines.length - 1} data lines from ${csvFilename}`);

            } catch (error) {
                console.error(`Error loading or parsing CSV (${csvFilename}):`, error);
                tbody.innerHTML = ''; // Clear table body on error
                thead.innerHTML = ''; // Clear headers on error too
                errorContainer.innerHTML = `<p class="error-message">Error loading stats (${csvFilename}): ${error.message}</p>`;
            }
        }
        // --- End of loadCsvData Function ---


        // --- Updated Call to loadCsvData ---
        document.addEventListener('DOMContentLoaded', () => {
            loadCsvData('pitching stats.csv', 'pitching-thead', 'pitching-tbody', 'error-container');
        });
    </script>

</body>
</html>